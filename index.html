<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Deal Qualification Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg-body: #f5f5f7;
        --bg-surface: #ffffff;
        --bg-subtle: #f9fafb;
        --border-subtle: #e5e7eb;
        --text-main: #111827;
        --text-muted: #6b7280;
        --radius-lg: 12px;
        --radius-md: 10px;
        --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.04);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg-body);
        color: var(--text-main);
      }
      .app-root {
        max-width: 1200px;
        margin: 24px auto 40px;
        padding: 0 16px;
      }
      header.app-header {
        margin-bottom: 8px;
      }
      h1 {
        font-size: 24px;
        font-weight: 700;
        margin: 0 0 4px;
      }
      .subtitle {
        margin: 0 0 16px;
        color: var(--text-muted);
        font-size: 14px;
      }
      .tabs {
        display: flex;
        gap: 4px;
        margin: 16px 0 12px;
        padding: 2px;
        border-radius: 999px;
        background: #e5e7eb80;
        width: fit-content;
      }
      .tab-button {
        padding: 8px 16px;
        border-radius: 999px;
        border: none;
        background: transparent;
        font-size: 13px;
        color: var(--text-muted);
        cursor: pointer;
        transition: background 0.15s ease, color 0.15s ease;
      }
      .tab-button.active {
        background: var(--bg-surface);
        color: var(--text-main);
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
      }
      .panel {
        background: var(--bg-surface);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-subtle);
        padding: 18px 20px 20px;
        box-shadow: var(--shadow-soft);
      }
      .panel + .panel {
        margin-top: 16px;
      }
      .panel h2 {
        margin: 0 0 4px;
        font-size: 18px;
      }
      .panel-desc {
        margin: 0 0 16px;
        font-size: 13px;
        color: var(--text-muted);
      }
      .card {
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
        padding: 14px 16px 16px;
        background: var(--bg-subtle);
      }
      .card + .card {
        margin-top: 12px;
      }
      .card h3 {
        margin: 0 0 8px;
        font-size: 15px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }
      th,
      td {
        border-bottom: 1px solid var(--border-subtle);
        padding: 6px 4px;
        vertical-align: middle;
      }
      th {
        text-align: left;
        font-size: 12px;
        color: var(--text-muted);
      }
      tr:last-child td {
        border-bottom: none;
      }
      .col-label {
        width: 38%;
      }
      .col-score {
        width: 22%;
      }
      .col-avg {
        width: 14%;
        text-align: center;
      }
      .col-info {
        width: 26%;
        text-align: right;
      }
      select {
        width: 100%;
        padding: 4px 6px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background: var(--bg-surface);
        font-size: 13px;
      }
      .info-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        background: var(--bg-subtle);
        font-size: 12px;
        color: #4b5563;
        cursor: default;
        position: relative;
      }
      .info-tooltip {
        position: absolute;
        top: 28px;
        right: 0;
        min-width: 220px;
        max-width: 320px;
        padding: 8px 10px;
        border-radius: 10px;
        background: #111827;
        color: #f9fafb;
        font-size: 11px;
        line-height: 1.4;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
        white-space: pre-line;
        z-index: 20;
      }
      .info-tooltip::before {
        content: "";
        position: absolute;
        top: -6px;
        right: 10px;
        border-width: 0 6px 6px 6px;
        border-style: solid;
        border-color: transparent transparent #111827 transparent;
      }
      .score-row-label {
        font-weight: 500;
      }
      .score-row-label span.sub {
        display: block;
        margin-top: 2px;
        font-weight: 400;
        color: var(--text-muted);
        font-size: 11px;
      }
      .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 7px 14px;
        border-radius: 999px;
        border: none;
        background: #111827;
        color: #f9fafb;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.05s ease;
      }
      .btn-primary:hover {
        background: #020617;
      }
      .btn-primary:active {
        transform: translateY(1px);
      }
      .btn-primary:disabled {
        background: #9ca3af;
        cursor: default;
        transform: none;
      }
      .btn-weight {
        width: 30px;
        height: 30px;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        background: var(--bg-surface);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        cursor: pointer;
      }
      .btn-weight:hover {
        background: #e5e7eb;
      }
      .actions-row {
        display: flex;
        justify-content: flex-end;
        margin-top: 12px;
      }
      .result-box {
        margin-top: 14px;
        padding: 10px 12px;
        border-radius: 10px;
        background: #ecfeff;
        border: 1px solid #67e8f9;
        font-size: 13px;
      }
      .result-box h4 {
        margin: 0 0 6px;
        font-size: 14px;
      }
      .result-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 4px 12px;
        font-size: 13px;
      }
      .result-label {
        color: var(--text-muted);
      }
      .result-value {
        font-weight: 600;
      }
      .risk-box {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 10px;
        background: #fef2f2;
        border: 1px solid #fecaca;
        font-size: 13px;
      }
      .risk-title {
        margin: 0 0 4px;
        font-weight: 600;
        font-size: 13px;
      }
      .risk-item {
        margin: 2px 0;
      }
      .muted {
        color: #9ca3af;
        font-size: 13px;
      }
      .weight-toggle {
        margin-top: 12px;
      }
      .weight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
      }
      .weight-header span {
        font-size: 13px;
        font-weight: 500;
      }
      .weight-body {
        margin-top: 8px;
        border-radius: 10px;
        background: #f3f4f6;
        padding: 8px 10px;
      }
      .weight-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 6px;
      }
      .weight-row:last-child {
        margin-bottom: 0;
      }
      .weight-label {
        font-size: 13px;
      }
      .weight-controls {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .weight-value {
        min-width: 46px;
        text-align: center;
        font-size: 13px;
        font-weight: 600;
      }
      .weight-error {
        margin-top: 6px;
        font-size: 11px;
        color: #b91c1c;
      }
      .weight-total {
        margin-top: 4px;
        font-size: 11px;
        color: var(--text-muted);
      }
      .quadrant-layout {
        display: flex;
        gap: 16px;
        margin-top: 14px;
      }
      .quadrant-left,
      .quadrant-right {
        flex: 1;
      }
      .quadrant-axes {
        position: relative;
        width: 100%;
        max-width: 420px;
        aspect-ratio: 1 / 1;
        margin: 0 auto 28px;
        background: var(--bg-subtle);
        border-radius: 12px;
        border: 1px solid var(--border-subtle);
        overflow: visible;
      }
      .quadrant {
        position: absolute;
        width: 50%;
        height: 50%;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding-top: 8px;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-main);
      }
      .quadrant.q1 {
        top: 0;
        left: 50%;
        background: #ecfdf3;
        color: #166534;
      }
      .quadrant.q2 {
        bottom: 0;
        left: 50%;
        background: #fef9c3;
        color: #92400e;
      }
      .quadrant.q3 {
        top: 0;
        left: 0;
        background: #e0f2fe;
        color: #075985;
      }
      .quadrant.q4 {
        bottom: 0;
        left: 0;
        background: #fee2e2;
        color: #b91c1c;
      }
      .quadrant-cross {
        position: absolute;
        background: #9ca3af;
        opacity: 0.9;
      }
      .quadrant-cross.vertical {
        width: 1px;
        height: 100%;
        left: 50%;
        top: 0;
      }
      .quadrant-cross.horizontal {
        height: 1px;
        width: 100%;
        top: 50%;
        left: 0;
      }
      .quadrant-marker {
        position: absolute;
        transform: translate(-50%, -50%);
        pointer-events: none;
      }
      .marker-dot {
        width: 18px;
        height: 18px;
        display: block;
        border-radius: 50%;
        background: #111827;
        border: 3px solid var(--bg-subtle);
        box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.35);
      }
      .axis-title-x,
      .axis-title-y {
        position: absolute;
        font-size: 12px;
        color: #374151;
        font-weight: 500;
      }
      .axis-title-x {
        bottom: -24px;
        left: 50%;
        transform: translateX(-50%);
      }
      .axis-title-y {
        left: -40px;
        top: 50%;
        transform: translateY(-50%) rotate(-90deg);
        transform-origin: center;
      }
      .summary-title {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: 600;
      }
      .summary-overview {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-main);
      }
      .summary-text,
      .summary-action {
        font-size: 15px;
        line-height: 1.6;
        margin: 0 0 8px;
        color: #1f2937;
      }
      .summary-action strong {
        font-weight: 600;
      }
      .summary-card .summary-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px 12px;
        font-size: 13px;
      }
      .summary-grid .label {
        display: block;
        font-size: 12px;
        color: var(--text-muted);
      }
      .summary-grid .value {
        font-weight: 600;
      }
      @media (max-width: 900px) {
        .quadrant-layout {
          flex-direction: column;
        }
        .quadrant-right {
          margin-top: 8px;
        }
      }
    </style>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <main id="root" class="app-root"></main>

    <script type="text/babel">
      const { useState } = React;

      const rangeOptions = (from, to) => {
        const arr = [];
        for (let v = from; v >= to; v--) {
          arr.push(v);
        }
        return arr;
      };

      const dealDetailItems = [
        {
          id: "budget",
          group: "Budget",
          label: "예산 및 구매 준비도",
          scoring: `1: 예산 없음 / 승인 의사 없음
2: 예산은 없지만 “요청해보겠다” 수준 / 가능성 낮음
3: 예산 가능하나 승인 필요 / 가격 민감 / 불확실
4: 예산 라인 존재 / 관련 부서 논의 중
5: 예산 확정 / 승인권자 동의 / 구매 절차 명확`,
        },
        {
          id: "champion",
          group: "Authority",
          label: "내부 지지자 파워",
          scoring: `1: 챔피언 없음 / 단순 관심자
2: 챔피언 후보 있으나 영향력 약함
3: 실무 리더급 챔피언 / 내부 논의 주도 가능
4: 중간 관리자급 챔피언 / 의사결정자 연결 가능
5: 파워 챔피언 / 적극적 지지 / 내부 추진 강함`,
        },
        {
          id: "ebAccess",
          group: "Authority",
          label: "의사결정권자 접근성",
          scoring: `1: EB를 모름 / 접근 불가
2: EB는 알지만 접촉 불가 / 간접 정보만 있음
3: 의사결정 구조 파악 / EB 접촉 가능성 존재
4: 영향력 있는 관리자 접촉 / EB 경로 확보
5: EB와 직접 대화 / 니즈·우선순위 확인됨`,
        },
        {
          id: "problemFit",
          group: "Need",
          label: "문제 적합성",
          scoring: `1: 문제 모호 / 솔루션과 연결 약함
2: 문제는 있으나 Fit 낮음 / 고객도 확신 없음
3: 문제 명확 / 솔루션으로 해결 가능
4: 문제 해결 의지 강함 / Fit 높음
5: 핵심 Pain / 우리 솔루션이 가장 적합`,
        },
        {
          id: "competition",
          group: "Need",
          label: "경쟁 구도",
          scoring: `1: 경쟁사 우위 / 고객 선호도 낮음
2: 경쟁 우세 / 우리 쪽 약함
3: 비슷비슷 / 비교 초기
4: 여러 면에서 우리가 우위
5: 사실상 우리 선택 / PoC 시 확정 수준`,
        },
        {
          id: "urgency",
          group: "Timeline",
          label: "시급성/타이밍",
          scoring: `1: 급하지 않음 / 계획 없음
2: 관심은 있으나 일정 불확실
3: 분기 내 검토 필요 / 일정 일부 존재
4: 프로젝트 일정과 연결 / 조만간 결정 필요
5: 즉시 필요 / 계약·규제 등 긴급 사유`,
        },
        {
          id: "ease",
          group: "Timeline",
          label: "도입 용이성",
          scoring: `1: 기술적 장애 큼 / 통합 어려움
2: 장벽 있지만 가능 / 리스크 존재
3: 일반적 난이도 / 보통 수준
4: 도입 쉬움 / 통합 간단
5: 즉시 사용 가능 / 리스크 거의 없음`,
        },
      ];

      const defaultDealWeights = {
        Budget: 0.3,
        Authority: 0.25,
        Need: 0.3,
        Timeline: 0.15,
      };

      const dealRiskMessages = {
        Budget: "예산 리스크: 구매 가능성 낮음",
        Authority: "권한/지지 리스크: 챔피언 또는 EB 접근이 약함",
        Need: "문제 적합성 리스크: 우리 솔루션의 비즈니스 명분이 약함",
        Timeline: "타이밍/도입 리스크: 우선순위 또는 도입 여건이 불리함",
      };

      const computeDealAggregates = (scores) => {
        const get = (id) => scores[id] ?? 0;
        const budget = get("budget");
        const authority = (get("champion") + get("ebAccess")) / 2;
        const need = (get("problemFit") + get("competition")) / 2;
        const timeline = (get("urgency") + get("ease")) / 2;
        return { budget, authority, need, timeline };
      };

      const computeDealScore = (aggregates, weights) => {
        const { budget, authority, need, timeline } = aggregates;
        const wBudget = weights.Budget ?? 0;
        const wAuth = weights.Authority ?? 0;
        const wNeed = weights.Need ?? 0;
        const wTime = weights.Timeline ?? 0;
        const raw =
          (wBudget * budget +
            wAuth * authority +
            wNeed * need +
            wTime * timeline) /
          5;
        return Math.round(raw * 100);
      };

      const mapDealScoreToWin = (score) => {
        if (score == null || Number.isNaN(score))
          return { probability: null, label: "-" };
        if (score <= 20) return { probability: 10, label: "매우 낮음" };
        if (score <= 40) return { probability: 30, label: "낮음" };
        if (score <= 60) return { probability: 50, label: "중간" };
        if (score <= 80) return { probability: 70, label: "높음" };
        return { probability: 90, label: "매우 높음" };
      };

      const techDetailItems = [
        {
          id: "funcFit",
          group: "Technical Fit",
          label: "기능 적합성",
          scoring: `1: 요구 기능 대부분 불일치 / 구현 어려움
2: 핵심 기능 일부 부족 / 커스터마이징 필수
3: 주요 기능 대부분 충족 / 보통 수준
4: 필수 기능 충족 / 옵션만 조정 필요
5: 요구사항 완전 일치 / 최적 Fit`,
        },
        {
          id: "customNeed",
          group: "Technical Fit",
          label: "커스터마이징 필요도",
          scoring: `1: 커스터마이징 많음 / 높은 복잡도
2: 개발 필요하나 가능 / 리스크 존재
3: 일반적 난이도 / 구현 가능
4: 소규모 구성 정도 / 부담 낮음
5: 구성만으로 즉시 적용 가능`,
        },
        {
          id: "legacy",
          group: "Technical Fit",
          label: "레거시 제약",
          scoring: `1: 레거시 제약 심각 / 연동 불가
2: 제약 존재 / 우회 가능하나 위험
3: 일부 제약 있으나 현실적 대안 존재
4: 제약 적음 / 대부분 호환
5: 제약 거의 없음 / 최적 환경`,
        },
        {
          id: "infra",
          group: "Environment",
          label: "인프라 호환성",
          scoring: `1: 호환 거의 불가 / 제약 매우 큼
2: 호환성 낮음 / 조정 필요
3: 보통 수준 호환 / 일부 검증 필요
4: 전반적 호환 양호
5: 완전 호환 / 즉시 사용 가능`,
        },
        {
          id: "integration",
          group: "Environment",
          label: "연동 지원 여부",
          scoring: `1: 연동 불가 혹은 매우 어려움
2: 연동 가능하나 난이도 높음
3: 일반적 난이도 / 표준 프로토콜 기반
4: 연동 수월함 / 기존 레퍼런스 존재
5: 즉시 연동 가능 / 장애 요소 없음`,
        },
        {
          id: "network",
          group: "Environment",
          label: "환경/네트워크 제약",
          scoring: `1: 환경·네트워크 제약 매우 심각
2: 제약 존재 / 설정 조정 필요
3: 일부 제약 있으나 관리 가능
4: 대부분 문제 없음
5: 제약 거의 없음 / 최적 환경`,
        },
        {
          id: "securityReview",
          group: "Compliance",
          label: "보안 검토 난이도",
          scoring: `1: 보안 충족 어려움 / 리스크 큼
2: 충족 가능하나 불확실성 큼
3: 보통 난이도 / 일부 검토 필요
4: 대부분 충족 / 승인 가능성 높음
5: 문제 없음 / 승인 확실`,
        },
        {
          id: "regulation",
          group: "Compliance",
          label: "규제 준수 가능성",
          scoring: `1: 규제 충족 불가
2: 충족 가능하나 장애물 많음
3: 대부분 충족 / 추가 조정 필요
4: 규제 충족 가능성이 높음
5: 완전 충족 / 검증 문제 없음`,
        },
        {
          id: "dataSecurity",
          group: "Compliance",
          label: "데이터/보안 적합성",
          scoring: `1: 요구 기준과 불일치
2: 일부 불일치 / 수정 필요
3: 대부분 충족 / 조정 가능
4: 전반적 적합 / 리스크 낮음
5: 완전 적합 / 요구 충족`,
        },
        {
          id: "teamReady",
          group: "Human",
          label: "고객 기술팀 준비도",
          scoring: `1: 리소스 없음 / 진행 불가
2: 리소스 부족 / 일정 위험
3: 기본 역량 충분 / 일반적 수행 가능
4: 역량 충분 / 협업 적극적
5: 매우 적극적 / 전문성 높음`,
        },
        {
          id: "supportRes",
          group: "Human",
          label: "도입 지원 리소스",
          scoring: `1: 지원 리소스 거의 없음
2: 리소스 부족 / 일정 불확실
3: 일반적 수준 / 일부 조율 필요
4: 충분한 지원 가능
5: 즉시 투입 가능 / 여유 있음`,
        },
        {
          id: "timelineReal",
          group: "Human",
          label: "일정/범위 현실성",
          scoring: `1: 일정 불명확 / 실현 어려움
2: 일정 모호 / 우선순위 낮음
3: 일정 존재 / 변동 가능성 있음
4: 일정 명확 / 실행력 있음
5: 즉시 착수 가능 / 강한 추진력`,
        },
      ];

      const defaultTechWeights = {
        TechnicalFit: 0.35,
        Environment: 0.25,
        Compliance: 0.2,
        Human: 0.2,
      };

      const techRiskMessages = {
        TechnicalFit:
          "기능/레거시 적합성 리스크: 기능 Fit 또는 레거시 제약이 큼",
        Environment:
          "환경/연동 리스크: 인프라·네트워크·연동 제약 존재",
        Compliance:
          "보안/규제 리스크: 보안 승인 또는 규제 충족에 리스크",
        Human:
          "실행 준비도 리스크: 고객/우리 쪽 리소스·일정 여건이 불리함",
      };

      const computeTechAggregates = (scores) => {
        const get = (id) => scores[id] ?? 0;
        const technical = (get("funcFit") + get("customNeed") + get("legacy")) / 3;
        const environment = (get("infra") + get("integration") + get("network")) / 3;
        const compliance =
          (get("securityReview") + get("regulation") + get("dataSecurity")) / 3;
        const human =
          (get("teamReady") + get("supportRes") + get("timelineReal")) / 3;
        return { technical, environment, compliance, human };
      };

      const computeTechScore = (aggregates, weights) => {
        const { technical, environment, compliance, human } = aggregates;
        const wTech = weights.TechnicalFit ?? 0;
        const wEnv = weights.Environment ?? 0;
        const wComp = weights.Compliance ?? 0;
        const wHuman = weights.Human ?? 0;
        const raw =
          (wTech * technical +
            wEnv * environment +
            wComp * compliance +
            wHuman * human) /
          5;
        return Math.round(raw * 100);
      };

      const mapTechScoreToRisk = (score) => {
        if (score == null || Number.isNaN(score))
          return { level: null, label: "-" };
        if (score <= 20) return { level: "매우 높음", label: "기술적 불가" };
        if (score <= 40) return { level: "높음", label: "중단 고려" };
        if (score <= 60) return { level: "중간", label: "주의 필요" };
        if (score <= 80) return { level: "낮음", label: "적합함" };
        return { level: "매우 낮음", label: "매우 적합" };
      };

      function WeightAdjuster({ weights, onChange, weightOrder }) {
        const [open, setOpen] = useState(false);

        const total = weightOrder.reduce(
          (sum, key) => sum + (weights[key] ?? 0),
          0
        );
        const roundedTotal = Math.round(total * 100) / 100;
        const hasError = Math.abs(total - 1) > 0.001;

        const adjust = (key, delta) => {
          const current = weights[key] ?? 0;
          let next = current + delta;
          if (next < 0) next = 0;
          if (next > 1) next = 1;
          onChange({ ...weights, [key]: Math.round(next * 100) / 100 });
        };

        return (
          <div className="weight-toggle">
            <div
              className="weight-header"
              onClick={() => setOpen((v) => !v)}
              aria-expanded={open}
            >
              <span>가중치 조정</span>
              <span className="muted">{open ? "접기" : "펼치기"}</span>
            </div>
            {open && (
              <div className="weight-body">
                {weightOrder.map((key) => (
                  <div className="weight-row" key={key}>
                    <div className="weight-label">{key}</div>
                    <div className="weight-controls">
                      <button
                        type="button"
                        className="btn-weight"
                        onClick={() => adjust(key, -0.05)}
                        aria-label={`${key} 가중치 감소`}
                      >
                        -
                      </button>
                      <div className="weight-value">
                        {(weights[key] ?? 0).toFixed(2)}
                      </div>
                      <button
                        type="button"
                        className="btn-weight"
                        onClick={() => adjust(key, 0.05)}
                        aria-label={`${key} 가중치 증가`}
                      >
                        +
                      </button>
                    </div>
                  </div>
                ))}
                <div className="weight-total">
                  합계: {roundedTotal.toFixed(2)}
                </div>
                {hasError && (
                  <div className="weight-error">
                    가중치 합이 1이 되도록 조정해 주세요.
                  </div>
                )}
              </div>
            )}
          </div>
        );
      }

      function DealWinTab({ onResultChange }) {
        const [scores, setScores] = useState({});
        const [weights, setWeights] = useState(defaultDealWeights);
        const [hoverId, setHoverId] = useState(null);
        const [result, setResult] = useState(null);

        const handleScoreChange = (id, value) => {
          const num = value ? Number(value) : null;
          setScores((prev) => ({ ...prev, [id]: num }));
        };

        const handleCalculate = () => {
          const totalW =
            (weights.Budget ?? 0) +
            (weights.Authority ?? 0) +
            (weights.Need ?? 0) +
            (weights.Timeline ?? 0);
          if (Math.abs(totalW - 1) > 0.001) {
            alert("Deal Win Score 가중치 합이 1이 되도록 조정해 주세요.");
            return;
          }
          const aggr = computeDealAggregates(scores);
          const score = computeDealScore(aggr, weights);
          const { probability, label } = mapDealScoreToWin(score);

          const riskItems = [];
          if (aggr.budget > 0 && aggr.budget <= 2)
            riskItems.push(dealRiskMessages.Budget);
          if (aggr.authority > 0 && aggr.authority <= 2)
            riskItems.push(dealRiskMessages.Authority);
          if (aggr.need > 0 && aggr.need <= 2)
            riskItems.push(dealRiskMessages.Need);
          if (aggr.timeline > 0 && aggr.timeline <= 2)
            riskItems.push(dealRiskMessages.Timeline);

          const res = {
            score,
            winProbability: probability,
            winLabel: label,
            aggregates: aggr,
            riskItems,
          };
          setResult(res);
          onResultChange && onResultChange(res);
        };

        const options = rangeOptions(5, 1);

        return (
          <section className="panel" aria-label="Deal Win Score">
            <h2>Deal Win Score (BANT)</h2>
            <p className="panel-desc">
              BANT 기반으로 Deal Score와 Win Probability를 계산합니다.
            </p>

            <section className="card">
              <h3>Deal 항목</h3>
              <table>
                <thead>
                  <tr>
                    <th className="col-label">세부 항목</th>
                    <th className="col-score">점수 (5~1)</th>
                    <th className="col-avg">합산</th>
                    <th className="col-info">Scoring 기준</th>
                  </tr>
                </thead>
                <tbody>
                  {dealDetailItems.map((item) => (
                    <tr key={item.id}>
                      <td className="col-label">
                        <div className="score-row-label">
                          {item.group}
                          <span className="sub">{item.label}</span>
                        </div>
                      </td>
                      <td className="col-score">
                        <select
                          value={scores[item.id] ?? ""}
                          onChange={(e) =>
                            handleScoreChange(item.id, e.target.value)
                          }
                          aria-label={`${item.group} - ${item.label} 점수`}
                        >
                          <option value="">-</option>
                          {options.map((v) => (
                            <option key={v} value={v}>
                              {v}
                            </option>
                          ))}
                        </select>
                      </td>
                      <td className="col-avg" />
                      <td className="col-info">
                        <button
                          type="button"
                          className="info-btn"
                          onMouseEnter={() => setHoverId(item.id)}
                          onMouseLeave={() => setHoverId(null)}
                          aria-label={`${item.group} Scoring 기준`}
                        >
                          i
                          {hoverId === item.id && (
                            <div className="info-tooltip">{item.scoring}</div>
                          )}
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>

              <WeightAdjuster
                weights={weights}
                onChange={setWeights}
                weightOrder={["Budget", "Authority", "Need", "Timeline"]}
              />

              <div className="actions-row">
                <button
                  className="btn-primary"
                  type="button"
                  onClick={handleCalculate}
                >
                  결과 보기
                </button>
              </div>

              {result && (
                <>
                  <div className="result-box">
                    <h4>결과</h4>
                    <div className="result-grid">
                      <div>
                        <span className="result-label">Deal Score</span>
                      </div>
                      <div className="result-value">
                        {result.score} / 100
                      </div>
                      <div>
                        <span className="result-label">Win Probability</span>
                      </div>
                      <div className="result-value">
                        {result.winProbability}% ({result.winLabel})
                      </div>
                    </div>
                  </div>

                  {result.riskItems.length > 0 && (
                    <div className="risk-box">
                      <div className="risk-title">Risk Summary</div>
                      {result.riskItems.map((r, idx) => (
                        <div key={idx} className="risk-item">
                          - {r}
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}
            </section>
          </section>
        );
      }

      function TechnicalFitTab({ onResultChange }) {
        const [scores, setScores] = useState({});
        const [weights, setWeights] = useState(defaultTechWeights);
        const [hoverId, setHoverId] = useState(null);
        const [result, setResult] = useState(null);

        const handleScoreChange = (id, value) => {
          const num = value ? Number(value) : null;
          setScores((prev) => ({ ...prev, [id]: num }));
        };

        const handleCalculate = () => {
          const totalW =
            (weights.TechnicalFit ?? 0) +
            (weights.Environment ?? 0) +
            (weights.Compliance ?? 0) +
            (weights.Human ?? 0);
          if (Math.abs(totalW - 1) > 0.001) {
            alert(
              "Technical Fit Score 가중치 합이 1이 되도록 조정해 주세요."
            );
            return;
          }
          const aggr = computeTechAggregates(scores);
          const score = computeTechScore(aggr, weights);
          const { level, label } = mapTechScoreToRisk(score);

          const riskItems = [];
          if (aggr.technical > 0 && aggr.technical <= 2)
            riskItems.push(techRiskMessages.TechnicalFit);
          if (aggr.environment > 0 && aggr.environment <= 2)
            riskItems.push(techRiskMessages.Environment);
          if (aggr.compliance > 0 && aggr.compliance <= 2)
            riskItems.push(techRiskMessages.Compliance);
          if (aggr.human > 0 && aggr.human <= 2)
            riskItems.push(techRiskMessages.Human);

          const res = {
            score,
            riskLevel: level,
            riskLabel: label,
            aggregates: aggr,
            riskItems,
          };
          setResult(res);
          onResultChange && onResultChange(res);
        };

        const options = rangeOptions(5, 1);

        return (
          <section className="panel" aria-label="Technical Fit Score">
            <h2>Technical Fit Score</h2>
            <p className="panel-desc">
              기술적 적합성을 정량화하고 기술 리스크 수준을 평가합니다.
            </p>

            <section className="card">
              <h3>적합성 항목</h3>
              <table>
                <thead>
                  <tr>
                    <th className="col-label">세부 항목</th>
                    <th className="col-score">점수 (5~1)</th>
                    <th className="col-avg">합산</th>
                    <th className="col-info">Scoring 기준</th>
                  </tr>
                </thead>
                <tbody>
                  {techDetailItems.map((item) => (
                    <tr key={item.id}>
                      <td className="col-label">
                        <div className="score-row-label">
                          {item.group}
                          <span className="sub">{item.label}</span>
                        </div>
                      </td>
                      <td className="col-score">
                        <select
                          value={scores[item.id] ?? ""}
                          onChange={(e) =>
                            handleScoreChange(item.id, e.target.value)
                          }
                          aria-label={`${item.group} - ${item.label} 점수`}
                        >
                          <option value="">-</option>
                          {options.map((v) => (
                            <option key={v} value={v}>
                              {v}
                            </option>
                          ))}
                        </select>
                      </td>
                      <td className="col-avg" />
                      <td className="col-info">
                        <button
                          type="button"
                          className="info-btn"
                          onMouseEnter={() => setHoverId(item.id)}
                          onMouseLeave={() => setHoverId(null)}
                          aria-label={`${item.group} Scoring 기준`}
                        >
                          i
                          {hoverId === item.id && (
                            <div className="info-tooltip">{item.scoring}</div>
                          )}
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>

              <WeightAdjuster
                weights={weights}
                onChange={setWeights}
                weightOrder={[
                  "TechnicalFit",
                  "Environment",
                  "Compliance",
                  "Human",
                ]}
              />

              <div className="actions-row">
                <button
                  className="btn-primary"
                  type="button"
                  onClick={handleCalculate}
                >
                  결과 보기
                </button>
              </div>

              {result && (
                <>
                  <div className="result-box">
                    <h4>결과</h4>
                    <div className="result-grid">
                      <div>
                        <span className="result-label">
                          Technical Fit Score
                        </span>
                      </div>
                      <div className="result-value">
                        {result.score} / 100
                      </div>
                      <div>
                        <span className="result-label">기술 리스크</span>
                      </div>
                      <div className="result-value">
                        {result.riskLevel} ({result.riskLabel})
                      </div>
                    </div>
                  </div>

                  {result.riskItems.length > 0 && (
                    <div className="risk-box">
                      <div className="risk-title">Risk Summary</div>
                      {result.riskItems.map((r, idx) => (
                        <div key={idx} className="risk-item">
                          - {r}
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}
            </section>
          </section>
        );
      }

      function DashboardTab({ dealResult, techResult }) {
        const businessFit = dealResult?.score ?? null;
        const technicalFit = techResult?.score ?? null;

        const determineQuadrant = () => {
          if (businessFit == null || technicalFit == null) return null;
          if (businessFit >= 50 && technicalFit >= 50)
            return { id: "q1", title: "Strong Opportunity (GO)" };
          if (businessFit >= 50 && technicalFit < 50)
            return { id: "q2", title: "Biz OK but Tech Risk" };
          if (businessFit < 50 && technicalFit >= 50)
            return { id: "q3", title: "Tech OK but Biz Weak" };
          return { id: "q4", title: "No-Go Zone" };
        };

        const quadrant = determineQuadrant();

        const buildSummary = () => {
          if (!quadrant) return { overview: "", details: "", action: "" };
          const parts = { overview: "", details: "", action: "" };

          parts.overview = quadrant.title;

          const deal = businessFit ?? 0;
          const tech = technicalFit ?? 0;

          if (quadrant.id === "q1") {
            parts.details = `이 딜은 Business Fit(${deal}점)과 Technical Fit(${tech}점)가 모두 높은 편입니다. 수주 가능성이 높고, 전략적으로 우선순위가 높은 Strong Opportunity입니다.`;
            parts.action =
              "상위 이해관계자 얼라인과 경쟁사 차단 전략을 강화하고, 계약/보안/구매 절차를 빠르게 진행하세요.";
          } else if (quadrant.id === "q2") {
            parts.details = `이 딜은 Business Fit(${deal}점)는 양호하지만, Technical Fit(${tech}점)는 상대적으로 낮습니다. 기술 리스크를 관리하지 않으면 이후 단계에서 중단될 위험이 있습니다.`;
            parts.action =
              "기술 리스크를 조기에 명확히 정의하고, PoC 범위 축소·옵션 제안·아키텍처 리뷰 등을 통해 ‘실행 가능한 대안’을 제시하세요.";
          } else if (quadrant.id === "q3") {
            parts.details = `이 딜은 Technical Fit(${tech}점)는 높은 편이지만, Business Fit(${deal}점)는 상대적으로 약합니다. 기술적으로는 좋은데, 비즈니스 명분과 내부 지지가 부족한 상태입니다.`;
            parts.action =
              "EB/챔피언 맵을 다시 정리하고, ROI·비용 절감·리스크 감소 같은 비즈니스 임팩트 스토리를 강화하세요. 경쟁사 대비 차별점을 명확히 전달하는 것이 중요합니다.";
          } else {
            parts.details = `이 딜은 Business Fit(${deal}점)과 Technical Fit(${tech}점) 모두 낮은 편입니다. 현재 상태로는 투자 대비 수익이 낮은 No-Go 후보입니다.`;
            parts.action =
              "추가 Discovery로 조건이 크게 바뀔 여지가 있는지 확인하고, 없다면 대응 중단 또는 Low-touch 대응으로 전환하는 것이 좋습니다.";
          }

          return parts;
        };

        const { overview, details, action } = buildSummary();

        const markerStyle =
          businessFit != null && technicalFit != null
            ? {
                left: `${businessFit}%`,
                top: `${100 - technicalFit}%`,
              }
            : { display: "none" };

        return (
          <section className="panel" aria-label="Dashboard">
            <h2>Dashboard</h2>
            <p className="panel-desc">
              Deal Win Score와 Technical Fit Score를 기반으로 딜 상태를
              Quadrant로 시각화합니다.
            </p>

            <section className="card summary-card">
              <h3>Score Summary</h3>
              <div className="summary-grid">
                <div>
                  <span className="label">Deal Win Score</span>
                  <span className="value">
                    {businessFit != null ? `${businessFit} / 100` : "-"}
                  </span>
                </div>
                <div>
                  <span className="label">Technical Fit Score</span>
                  <span className="value">
                    {technicalFit != null ? `${technicalFit} / 100` : "-"}
                  </span>
                </div>
                <div>
                  <span className="label">Win Probability</span>
                  <span className="value">
                    {dealResult?.winProbability != null
                      ? `${dealResult.winProbability}% (${dealResult.winLabel})`
                      : "-"}
                  </span>
                </div>
                <div>
                  <span className="label">Tech Risk Level</span>
                  <span className="value">
                    {techResult?.riskLevel
                      ? `${techResult.riskLevel} (${techResult.riskLabel})`
                      : "-"}
                  </span>
                </div>
              </div>
            </section>

            <section className="card quadrant-layout">
              <div className="quadrant-left">
                <h3>Quadrant View</h3>
                <div className="quadrant-axes">
                  <div className="quadrant q3">Tech OK but Biz Weak</div>
                  <div className="quadrant q1">GO</div>
                  <div className="quadrant q4">No-Go</div>
                  <div className="quadrant q2">Biz OK but Tech Risk</div>

                  <div className="quadrant-cross vertical" />
                  <div className="quadrant-cross horizontal" />

                  <div className="axis-title-x">Business Fit</div>
                  <div className="axis-title-y">Technical Fit</div>

                  <div className="quadrant-marker" style={markerStyle}>
                    <span className="marker-dot" />
                  </div>
                </div>
              </div>

              <div className="quadrant-right">
                <h3 className="summary-title">Deal Summary</h3>
                {businessFit == null || technicalFit == null ? (
                  <p className="muted">
                    먼저 Deal Win Score와 Technical Fit Score를 계산하면,
                    여기에서 총평과 권장 액션이 표시됩니다.
                  </p>
                ) : (
                  <>
                    <p className="summary-overview">{overview}</p>
                    <p className="summary-text">{details}</p>
                    <p className="summary-action">
                      <strong>권장 액션: </strong>
                      {action}
                    </p>
                  </>
                )}
              </div>
            </section>
          </section>
        );
      }

      function App() {
        const [activeTab, setActiveTab] = useState("deal");
        const [dealResult, setDealResult] = useState(null);
        const [techResult, setTechResult] = useState(null);

        return (
          <>
            <header className="app-header">
              <h1>Deal Qualification Tool</h1>
              <p className="subtitle">
                BANT 기반 Deal Win Score와 Technical Fit Score를 활용해 영업
                기회를 정량적으로 평가합니다.
              </p>
            </header>

            <nav
              className="tabs"
              role="tablist"
              aria-label="DQ Tool 탭 네비게이션"
            >
              <button
                className={`tab-button ${activeTab === "deal" ? "active" : ""}`}
                role="tab"
                aria-selected={activeTab === "deal"}
                onClick={() => setActiveTab("deal")}
              >
                Deal Win Score
              </button>
              <button
                className={`tab-button ${activeTab === "tech" ? "active" : ""}`}
                role="tab"
                aria-selected={activeTab === "tech"}
                onClick={() => setActiveTab("tech")}
              >
                Technical Fit Score
              </button>
              <button
                className={`tab-button ${
                  activeTab === "dashboard" ? "active" : ""
                }`}
                role="tab"
                aria-selected={activeTab === "dashboard"}
                onClick={() => setActiveTab("dashboard")}
              >
                Dashboard
              </button>
            </nav>

            {activeTab === "deal" && (
              <DealWinTab onResultChange={setDealResult} />
            )}
            {activeTab === "tech" && (
              <TechnicalFitTab onResultChange={setTechResult} />
            )}
            {activeTab === "dashboard" && (
              <DashboardTab dealResult={dealResult} techResult={techResult} />
            )}
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
